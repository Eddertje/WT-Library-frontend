<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <title>Make Reservation</title>
</head>
<body>
  <div id="sidebarContainer"></div>
  <script type="text/javascript" src="js/sidebar.js"></script>

  <div class="main">

      <div>
        <label for="searchTerm">Search Employee:</label>
        <input type="text" id="searchTerm">
        <button class="button" onclick="searchEmployee()">Search</button>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>First name</th>
            <th>Last name</th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody id="employeeTableBody"></tbody>
      </table>
      
      <div>
        <label for="selectedEmployee">Selected Employee:</label>
        <input type="text" id="selectedEmployee" disabled>
      </div>
      
      <div>
        <label for="searchTermBooks">Search Books:</label>
        <input type="text" id="searchTermBooks">
        <button class="button" onclick="searchBooks()">Search</button>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Writer</th>
            <th>ISBN</th>
          </tr>
        </thead>
        <tbody id="bookTableBody"></tbody>
      </table>
      
      <div>
        <label for="selectedBook">Selected Book:</label>
        <input type="text" id="selectedBook" disabled>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>Copy id</th>
          </tr>
        </thead>
        <tbody id="copyTableBody"></tbody>
      </table>
      
      <div>
        <label for="selectedCopy">Selected Copy:</label>
        <input type="text" id="selectedCopy" disabled>
      </div>
      
        <div>
        <h2>Create Loan</h2>
        <button class="button" onclick="createLoan()">Create Loan</button>
      </div>
  </div>
  
  <script type="text/javascript" src="js/loanManagement.js"></script>
  <script>
    function selectBook(book) {
      selectedBook = book;
      document.getElementById("selectedBook").value = book.title;
      showCopies(book)
    }

    function createLoan() {
      if (selectedEmployee && selectedBook && selectedCopy) {

        var loan = {
          copyId: selectedCopy.id,
          employeeId: selectedEmployee.employeeId
        };

        // Make an API call to your backend to create the reservation
        fetch(`${baseUrl}/loan/make`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(loan)
        })
        .then(response => response.json())
        .then(response => alert("Lening is aangemaakt."))
        .then(data => {
          console.log("Loan creation backend status:", data);
          selectedReservation = null;
          document.getElementById("selectedEmployee").value = "";
          document.getElementById("selectedBook").value = "";
          document.getElementById("selectedCopy").value = "";
          // Refresh available copies
          showCopies(selectedBook)
        })
        .catch(error => console.error(error));
      } else {
        console.log("Please select an employee and a book and a copy.");
      }
    }
  </script>
</body>
</html>