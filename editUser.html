<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <title>Document</title>
</head>

<body>
    <h1>Edit User</h1>
    <div>
        <label for="searchTerm">Search Term:</label>
        <input type="text" id="searchTerm">
        <button class="button" onclick="searchEmployee()">Search User</button>
    </div>

    <table>
        <thead>
        <tr>
            <th>First name</th>
            <th>Last name</th>
            <th>Email</th>
            <th>Admin</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="employeeTableBody"></tbody>
    </table>

    <div>
        <p>Currently editing:</p>
        <p id="curUser"></p>
    </div>

    <button class="button" onclick="searchEmployee()" id="makeAdmin">Set To Admin</button>
    <button class="button" onclick="searchEmployee()" id="setInactive">Set Inactive</button>

    <script>
        window.onload = searchEmployee()
        
        function searchEmployee() {
        var searchTerm = document.getElementById("searchTerm").value;
        
        // Make an API call to your backend
        fetch('http://localhost:8080/employees/search?searchTerm=' + searchTerm)
            .then(response => response.json())
            .then(data => {
            // Get the table body element
            var tableBody = document.getElementById("employeeTableBody");
        
            // Clear the table body before adding new rows
            tableBody.innerHTML = "";

            // Iterate over the employee data and create table rows dynamically
            data.forEach(employee => {
                // Create a new row element
                var row = tableBody.insertRow();

                // Create new cells for each data element
                var firstNameCell = row.insertCell();
                firstNameCell.innerHTML = employee.firstName;

                var lastNameCell = row.insertCell();
                lastNameCell.innerHTML = employee.lastName;

                var emailCell = row.insertCell();
                emailCell.innerHTML = employee.email;

                var adminCell = row.insertCell();
                adminCell.innerHTML = employee.admin ? "yes" : "no";

                var editCell = row.insertCell();
                console.log(employee)
                // Create a button element
                var button = document.createElement("button");
                button.textContent = "Edit";
                button.onclick = () => {
                    document.getElementById("curUser").innerHTML = employee.email;
                    document.getElementById("makeAdmin").onclick = () => makeAdmin(employee.employeeId)
                    document.getElementById("setInactive").onclick = () => makeInactive(employee.employeeId)
                }

                // Append the button to the edit cell
                editCell.appendChild(button);
            });
            })
            .catch(error => console.error(error));
        }

        function makeAdmin(id) {
            fetch('http://localhost:8080/employee/makeAdmin?id=' + id)
            .then(() => searchEmployee())
        }

        function makeInactive(id) {
            fetch('http://localhost:8080/employee/makeInactive?id=' + id)
            .then(() => searchEmployee())
        }
    </script>
</body>

</html>